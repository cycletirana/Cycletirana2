# =========================

# CycleTirana hardened .htaccess

# =========================

# --- Force HTTPS

RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# --- Security headers

<IfModule mod_headers.c>
  # HSTS (1 year) + preload
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

# Clickjacking / MIME sniffing / Referrer / Permissions

Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-Content-Type-Options "nosniff"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), interest-cohort=()"

# --- Content Security Policy (CSP)

# Keeps Maps + Swiper/CDNs + your images/videos

# Adds Google Ads/Conversions/Tag Manager/Analytics

Header always set Content-Security-Policy "\
 default-src 'self'; \
 base-uri 'self'; \
 object-src 'none'; \
 frame-ancestors 'self'; \
 upgrade-insecure-requests; \
 img-src 'self' data: blob: https: \
 https://www.google.com https://www.gstatic.com \
 https://www.google-analytics.com https://googleads.g.doubleclick.net https://www.googleadservices.com \
 https://maps.gstatic.com https://maps.googleapis.com \
 https://_.googleusercontent.com https://_.tile.openstreetmap.org; \
 media-src 'self' blob: https:; \
 font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net data:; \
 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com; \
 script-src 'self' 'unsafe-inline' 'unsafe-eval' \
 https://www.googletagmanager.com https://www.google-analytics.com \
 https://www.google.com https://www.gstatic.com \
 https://googleads.g.doubleclick.net https://www.googleadservices.com \
 https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com \
 https://maps.googleapis.com https://maps.gstatic.com; \
 connect-src 'self' \
 https://www.google-analytics.com https://www.googletagmanager.com \
 https://www.google.com https://stats.g.doubleclick.net \
 https://googleads.g.doubleclick.net https://www.googleadservices.com \
 https://maps.googleapis.com https://maps.gstatic.com https://_.tile.openstreetmap.org; \
 frame-src 'self' \
 https://www.google.com https://_.google.com \
 https://www.googletagmanager.com https://googleads.g.doubleclick.net; \
 worker-src 'self' blob:;"

# (Optional CORS example)

# Header always set Access-Control-Allow-Origin "https://www.cycletirana.com"

# Header always set Vary "Origin"

</IfModule>

# --- Disable dangerous HTTP methods

<IfModule mod_rewrite.c>
  RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK|DELETE|PUT|PATCH|PROPFIND|MKCOL|COPY|MOVE|LOCK|UNLOCK)$ [NC]
  RewriteRule .* - [F]
</IfModule>

# --- Hide dotfiles and sensitive paths

<FilesMatch "^\.">
Require all denied
</FilesMatch>
<IfModule mod_authz_core.c>
<FilesMatch "(^\.|composer\.(json|lock)|package(-lock)?\.json|yarn\.lock|pnpm-lock\.yaml|webpack\.config\.js|vite\.config\.js|gulpfile\.js|Gruntfile\.js|Makefile|Dockerfile|docker-compose\.yml|env|\.env|\.git|\.hg|\.svn|backup|dump)">
Require all denied
</FilesMatch>
</IfModule>

# --- Content-type safety

AddType text/css .css
AddType application/javascript .js

# --- Caching

<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/css               "access plus 7 days"
  ExpiresByType application/javascript "access plus 7 days"
  ExpiresByType image/webp             "access plus 30 days"
  ExpiresByType image/avif             "access plus 30 days"
  ExpiresByType image/png              "access plus 30 days"
  ExpiresByType image/jpg              "access plus 30 days"
  ExpiresByType image/jpeg             "access plus 30 days"
  ExpiresByType image/svg+xml          "access plus 30 days"
  ExpiresByType font/woff2             "access plus 30 days"
</IfModule>

# --- Prevent directory listing

Options -Indexes

# --- SPA fallback (disabled)

# RewriteCond %{REQUEST_FILENAME} !-f

# RewriteCond %{REQUEST_FILENAME} !-d

# RewriteRule . /index.html [L]

# =========================

# End

# =========================
