# ===== Force HTTPS (always redirect to https) =====

RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ===== Canonical domain (optional: non-www to www, or reverse) =====

# Uncomment ONE of the following blocks depending on your preference:

# --- Redirect www to non-www (https://cycletirana.com) ---

#RewriteCond %{HTTP_HOST} ^www\.cycletirana\.com$ [NC]
#RewriteRule ^ https://cycletirana.com%{REQUEST_URI} [L,R=301]

# --- Redirect non-www to www (https://www.cycletirana.com) ---

#RewriteCond %{HTTP_HOST} !^www\. [NC]
#RewriteRule ^ https://www.%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ===== Security Headers =====

<IfModule mod_headers.c>
  # HSTS: enforce HTTPS for 1 year + preload
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

# Prevent clickjacking

Header always set X-Frame-Options "SAMEORIGIN"

# Stop MIME sniffing

Header always set X-Content-Type-Options "nosniff"

# Referrer policy

Header always set Referrer-Policy "strict-origin-when-cross-origin"

# Browser features control

Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=()"

# ===== Content Security Policy =====

# Allows:

# - your own site ('self')

# - Leaflet scripts, styles, and map tiles

# - Google Fonts (Poppins)

# - JS/CSS/CDN for gallery (example: jsDelivr, unpkg)

# - Inline styles (needed for Leaflet + galleries)

Header always set Content-Security-Policy "
default-src 'self';
base-uri 'self';
object-src 'none';
frame-ancestors 'self';
img-src 'self' data: blob: https://tile.openstreetmap.org https://_.tile.openstreetmap.org https://cdn.jsdelivr.net https://unpkg.com;
script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net;
style-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net https://fonts.googleapis.com;
font-src 'self' https://fonts.gstatic.com;
media-src 'self' blob:;
connect-src 'self' https://tile.openstreetmap.org https://_.tile.openstreetmap.org;
upgrade-insecure-requests;
"
</IfModule>

# ===== Hide server info / directory browsing =====

ServerSignature Off
Options -Indexes

# ===== Secure cookies (if you ever set cookies later) =====

<IfModule mod_headers.c>
  Header edit Set-Cookie "(?i)^((?:(?!;).)+)" "$1; Secure; HttpOnly; SameSite=Lax"
</IfModule>
