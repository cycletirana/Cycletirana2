# =========================

# CycleTirana hardened .htaccess

# =========================

# --- Force HTTPS (safe to keep even if hPanel also forces HTTPS)

RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# --- Security headers

<IfModule mod_headers.c>
  # HSTS (1 year) + preload (only keep if your site will ALWAYS be HTTPS)
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

# Clickjacking / MIME sniffing / Referrer / Permissions

Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-Content-Type-Options "nosniff"
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# Lock down powerful browser features you don't use

Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), interest-cohort=()"

# --- Content Security Policy (CSP)

# Allows your site, Google Maps (iframe & JS API), Google Fonts,

# Swiper + Font Awesome from JSDelivr/Cloudflare, images/video blobs.

Header always set Content-Security-Policy "\
 default-src 'self'; \
 base-uri 'self'; \
 object-src 'none'; \
 frame-ancestors 'self'; \
 upgrade-insecure-requests; \
 /_ IMAGES (site + GA pixel + Maps) _/ \
 img-src 'self' data: blob: https: https://www.google-analytics.com https://maps.gstatic.com https://maps.googleapis.com https://_.googleusercontent.com; \
 /_ AUDIO/VIDEO _/ \
 media-src 'self' blob: https:; \
 /_ FONTS _/ \
 font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net data:; \
 /_ STYLES (keep inline + CDNs + Google Fonts) _/ \
 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; \
 /_ SCRIPTS (add GTM/GA + keep Maps/CDNs) _/ \
 script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://maps.googleapis.com https://maps.gstatic.com; \
 /_ XHR/BEACON (allow GA/GTM hits) _/ \
 connect-src 'self' https://www.google-analytics.com https://www.googletagmanager.com; \
 /_ IFRAMES (Google Maps embed) _/ \
 frame-src 'self' https://www.google.com https://_.google.com;"

# Optional: Only if you serve any JSON/API from your domain (restrict as needed)

# Header always set Access-Control-Allow-Origin "https://www.cycletirana.com"

# Header always set Vary "Origin"

</IfModule>

# --- Disable dangerous HTTP methods (keep GET/POST/HEAD; OPTIONS left for safety)

<IfModule mod_rewrite.c>
  RewriteCond %{REQUEST_METHOD} ^(TRACE|TRACK|DELETE|PUT|PATCH|PROPFIND|MKCOL|COPY|MOVE|LOCK|UNLOCK)$ [NC]
  RewriteRule .* - [F]
</IfModule>

# --- Hide dotfiles and sensitive paths

<FilesMatch "^\.">
Require all denied
</FilesMatch>
<IfModule mod_authz_core.c>
<FilesMatch "(^\.|composer\.(json|lock)|package(-lock)?\.json|yarn\.lock|pnpm-lock\.yaml|webpack\.config\.js|vite\.config\.js|gulpfile\.js|Gruntfile\.js|Makefile|Dockerfile|docker-compose\.yml|env|\.env|\.git|\.hg|\.svn|backup|dump)">
Require all denied
</FilesMatch>
</IfModule>

# --- Content-type safety for common static assets

AddType text/css .css
AddType application/javascript .js

# --- Sensible caching for static assets (tweak durations if you like)

<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/css                      "access plus 7 days"
  ExpiresByType application/javascript        "access plus 7 days"
  ExpiresByType image/webp                    "access plus 30 days"
  ExpiresByType image/avif                    "access plus 30 days"
  ExpiresByType image/png                     "access plus 30 days"
  ExpiresByType image/jpg                     "access plus 30 days"
  ExpiresByType image/jpeg                    "access plus 30 days"
  ExpiresByType image/svg+xml                 "access plus 30 days"
  ExpiresByType font/woff2                    "access plus 30 days"
</IfModule>

# --- Prevent directory listing

Options -Indexes

# --- Fallback for single-page apps (disabled by default)

# RewriteCond %{REQUEST_FILENAME} !-f

# RewriteCond %{REQUEST_FILENAME} !-d

# RewriteRule . /index.html [L]

# =========================

# End

# =========================
